{% extends 'dashboard.html' %}
{% load static %}

{% block manage_network %}

    <div class="container">
        {% if error_status_message %}
            <div class="alert alert-warning alert-dismissible">
                <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
                <strong>Warning!</strong> {{ error_status_message }}
            </div>
        {% endif %}
        <div class="row">

            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <div class="row">
                            <div class="col">
                                <h1 class="card-title">Manage Network Devices</h1>
                            </div>
                            <form class="form" action="" method="post"> {% csrf_token %}
                                <div class="col">
                                    <span class="text-info" id="scanning_span"
                                          style="font-size: 15px"></span>
                                    <input type="submit" name="get_devices_details" value="Refresh List"
                                           class="btn btn-primary btn-customized" style="margin: 20px"
                                           onclick="ScanningLabel();">
                                </div>
                            </form>
                            <form class="form" action="" method="post"> {% csrf_token %}
                                <div class="col">
                                    {% if not traps_engine_running and traps_enabled %}
                                        <input type="submit" name="start_trap_engine"
                                               value="Start Trap Engine"
                                               class="btn btn-primary btn-customized"
                                               style="margin: 20px">
                                    {% elif traps_enabled and traps_engine_running %}
                                        <input type="submit" name="stop_trap_engine"
                                               value="Stop Trap Engine"
                                               class="btn btn-primary btn-customized"
                                               style="margin: 20px">
                                    {% else %}
                                        <h2 class="table-warning"> Traps are not enabled.</h2>
                                    {% endif %}
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col">
                                <div class="row">
                                    <div class="col">


                                        <table class="table">
                                            <thead>
                                            <tr>
                                                <th scope="col">ID</th>
                                                <th scope="col">Device Name</th>
                                                <th scope="col">Device Type</th>
                                                <th scope="col">No. Interfaces</th>
                                                <th scope="col">Software</th>
                                                <th scope="col">System Version</th>
                                                <th scope="col">Location</th>
                                                <th scope="col">Administrator</th>
                                            </tr>
                                            </thead>

                                            <tbody>
                                            {% for device in devices_details_output %}
                                                <tr>
                                                    <th scope="row">{{ device.id }}</th>
                                                    <td>
                                                        <a href="?device_id={{ device.id }}">{{ device.system_name }}
                                                        </a>
                                                    <td><p class="text-info">{{ device.device_type }} </p></td>
                                                    <td>{{ device.if_number }}</td>
                                                    <td>{{ device.system_image }}</td>
                                                    <td>{{ device.system_version }}</td>
                                                    <td>{{ device.system_location }}</td>
                                                    <td>{{ device.system_contact }}</td>

                                                </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                {% if device_detail_output or page_object %}
                    <div class="card">
                        <div class="card-header">
                            <div class="row">
                                <div class="col">
                                    <h3 class="card-title"> Device Details </h3>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <ul class="nav nav-tabs" id="device_details" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="system-tab" data-toggle="tab" href="#system"
                                       role="tab"
                                       aria-controls="home" aria-selected="true">System</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="interfaces-tab" data-toggle="tab" href="#interfaces"
                                       role="tab"
                                       aria-controls="profile" aria-selected="false">Interfaces</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="logs-tab" data-toggle="tab" href="#logs" role="tab"
                                       aria-controls="profile" aria-selected="false">Traps and Events</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="others-tab" data-toggle="tab" href="#others" role="tab"
                                       aria-controls="contact" aria-selected="false">Others</a>
                                </li>
                            </ul>
                            <div class="tab-content" id="device_details_content">

                                <div class="tab-pane fade show active" id="system" role="tabpanel"
                                     aria-labelledby="system-tab">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="card-title"><b>{{ device_detail_output.device_type }} System
                                                Details</b></h3>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col">
                                                    <p><b class="text-info">System Name</b>
                                                        : {{ device_detail_output.full_system_name }}</p>
                                                    <p><b class="text-info">Version</b>
                                                        : {{ device_detail_output.system_version }}</p>
                                                    <p><b class="text-info">Image</b>
                                                        : {{ device_detail_output.system_image }}</p>
                                                    <p><b class="text-info">Type</b>
                                                        : {{ device_detail_output.system_type }}</p>
                                                    <p><b class="text-info">Contact</b>
                                                        : {{ device_detail_output.system_contact }}</p>
                                                    <p><b class="text-info">Location</b>
                                                        : {{ device_detail_output.system_location }}</p>
                                                    <p><b class="text-info">System Up From</b>
                                                        : {{ device_detail_output.system_up_time }}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="interfaces" role="tabpanel"
                                     aria-labelledby="interfaces-tab">
                                    {% for interface in device_interfaces_output %}
                                        <div class="card">
                                            <div class="card-header">
                                                <h3 class="card-title"><b>{{ interface.interface_description }} </b>
                                                </h3>
                                            </div>
                                            <div class="card-body">
                                                <div class="card">
                                                    <div class="row">
                                                        <div class="col">
                                                            <p><b class="text-info">MAC
                                                                Address</b>: {{ interface.interface_physical_addr }}
                                                            </p>
                                                            <p><b class="text-info">IP Address</b>
                                                                : {{ interface.interface_ip }}</p>
                                                            <p><b class="text-info">Bandwidth</b>
                                                                : {{ interface.interface_speed }}
                                                                Kbits/sec
                                                            </p>
                                                            <p><b class="text-info">Admin Status</b>
                                                                : {{ interface.interface_admin_status }}

                                                            </p>
                                                            <p><b class="text-info">Operational Status</b>
                                                                : {{ interface.interface_operational_status }}</p>
                                                        </div>
                                                        <div class="col">
                                                            <p><b class="text-info">Input Unicast
                                                                Packets</b>: {{ interface.interface_in_unicast_packets }}
                                                            </p>
                                                            <p><b class="text-info">Output Unicast
                                                                Packets</b>: {{ interface.interface_out_unicast_packets }}
                                                            </p>
                                                            <p><b class="text-info">Input Errors</b>
                                                                : {{ interface.interface_in_errors }}
                                                            </p>
                                                            <p><b class="text-info">Output Errors</b>
                                                                : {{ interface.interface_out_errors }}
                                                            </p>
                                                            <p><b class="text-info">MTU</b>
                                                                : {{ interface.interface_mtu }} bytes</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                                <div class="tab-pane fade" id="logs" role="tabpanel" aria-labelledby="logs-tab">
                                    <div class="card">
                                        <div class="card-header"></div>

                                        <div class="card-body">
                                            <table class="table">
                                                <thead>
                                                <tr>
                                                    <th scope="col">ID</th>
                                                    <th scope="col">Datetime</th>
                                                    <th scope="col">Agent Address</th>
                                                    <th scope="col">Agent Port</th>
                                                    <th scope="col">Trap Details</th>
                                                </tr>
                                                </thead>

                                                <tbody>
                                                <div id="content">
                                                    {% for trap in page_object %}
                                                        <tr>
                                                            <th scope="row">{{ trap.id }}</th>
                                                            <td style="width: 160px">{{ trap.trap_date }}</td>
                                                            <td>{{ trap.trap_address }}</td>
                                                            <td>{{ trap.trap_port }}</td>
                                                            <td>{{ trap.trap_string_data }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                </div>

                                                <div class="pagination">
                                                    <span class="step-links" id="links">
                                                        {% if page_object.has_previous %}
                                                            <a href="?trap_page=1">&laquo; first</a>
                                                            <a href="?trap_page={{ page_object.previous_page_number }}">previous</a>
                                                        {% endif %}

                                                        <span class="current">
                                                            Page {{ page_object.number }} of {{ page_object.paginator.num_pages }}.
                                                        </span>

                                                        {% if page_object.has_next %}
                                                            <a href="?trap_page={{ page_object.next_page_number }}"
                                                               id="id_href_id"
                                                               data="{{ page_object.next_page_number }}">next</a>
                                                            <a href="?trap_page={{ page_object.paginator.num_pages }}">last &raquo;</a>
                                                        {% endif %}
                                                        <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
                                                        <script>
                                                        $("#id_href_id").click(function () {
                                                            var page_number = $(this).attr('data');
                                                            console.log(page_number);
                                                            {#TO DO - trzeba ogarnac ajaxa w taki sposob ze w momencie #}
                                                            {#kiedy kilkamy next page albo previous itp. to ajax wysya do django get requesta a on zwraca liste z trapami nie odswiezajac przy tym calej strony#}
                                                            {#https://simpleisbetterthancomplex.com/tutorial/2016/08/29/how-to-work-with-ajax-request-with-django.html#}
                                                            $.ajax({
                                                                type: 'GET',
                                                                url: 'dashboard/manage_network/ajax/page',
                                                                data: {
                                                                    'page_number': page_number,
                                                                    'test': 'ide zaraz w kimie',
                                                                },
                                                                dataType: 'json',
                                                                success: function (data) {
                                                                    alert(data.test1)z
                                                                }
                                                            });

                                                        });

                                                    </script>

                                                    </span>
                                                </div>
                                                </tbody>
                                            </table>


                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="others" role="tabpanel" aria-labelledby="others-tab">

                                    <div class="card">

                                        <div class="card-header">
                                            <div class="row">
                                                <div class="col">
                                                    {% if device_detail_output %}
                                                        <h3 class="card-title" style="padding-top: 20px">
                                                            <b>{{ device_detail_output.full_system_name }}</b>
                                                        </h3>
                                                    {% endif %}
                                                </div>
                                                <form class="form" action="" method="post"> {% csrf_token %}
                                                    <div class="col">
                                                        <input type="submit" name="run_ssh_session" value="SSH Session"
                                                               class="btn btn-primary btn-customized"
                                                               style="margin: 20px">
                                                        <input type="hidden" name="run_ssh_session"
                                                               value="{{ device_detail_output.id }}">

                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>

{% endblock %}